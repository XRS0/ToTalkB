<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Chat Room</title>
    <style type="text/css">
      #log {
        height: 80vh;
        overflow-y: auto;
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 10px;
        background: #f9f9f9;
      }
      #form {
        display: flex;
        margin-top: 10px;
      }
      #msg {
        flex-grow: 1;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      button {
        padding: 8px 15px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        margin-left: 5px;
        cursor: pointer;
      }
      .message {
        margin: 10px 0;
        padding: 8px 12px;
        border-radius: 8px;
        max-width: 70%;
        position: relative;
        word-wrap: break-word;
      }
      .your-message {
        background: #dcf8c6;
        margin-left: auto;
        border-top-right-radius: 0;
      }
      .your-message::before {
        content: "";
        position: absolute;
        right: -8px;
        top: 0;
        width: 8px;
        height: 100%;
        background: #4caf50;
        border-top-right-radius: 8px;
        border-bottom-right-radius: 8px;
      }
      .other-message {
        background: #ececec;
        margin-right: auto;
        border-top-left-radius: 0;
      }
    </style>
  </head>
  <body>
    <h2>Chat Room: <span id="chatId"></span></h2>
    <div id="log"></div>
    <form id="form">
      <input type="text" id="msg" placeholder="Type your message" autofocus />
      <button type="submit">Send</button>
    </form>

    <script>
      window.onload = function () {
        const chatId = window.location.pathname.split("/").pop();
        const conn = new WebSocket(
          `ws://${document.location.host}/ws/${chatId}`
        );
        const msgInput = document.getElementById("msg");
        const chatLog = document.getElementById("log");
        const form = document.getElementById("form");

        function appendMessage(message, isMyMessage = false) {
          const messageElement = document.createElement("div");
          messageElement.className = isMyMessage
            ? "message your-message"
            : "message other-message";
          messageElement.innerText = isMyMessage
            ? message
            : `Other: ${message}`;
          chatLog.appendChild(messageElement);
          chatLog.scrollTop = chatLog.scrollHeight;
        }

        form.onsubmit = function (e) {
          e.preventDefault();
          if (!msgInput.value) return;

          conn.send(msgInput.value);
          appendMessage(msgInput.value, true);
          msgInput.value = "";
        };

        conn.onopen = function () {
          appendMessage("Connected to chat room");
        };

        conn.onmessage = function (evt) {
          appendMessage(evt.data, false);
        };

        conn.onclose = function () {
          appendMessage("Disconnected from chat");
        };

        conn.onerror = function (err) {
          console.error("WebSocket error:", err);
          appendMessage("Connection error");
        };

        document.getElementById("chatId").textContent = chatId;
      };
    </script>
  </body>
</html>
